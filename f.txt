{
  "schemaVersion": "2.2",
  "description": "Get Windows root (C:) volume free space in GB",
  "parameters": {},
  "mainSteps": [
    {
      "name": "GetRootFreeSpace",
      "action": "aws:runPowerShellScript",
      "precondition": {
        "StringEquals": [
          "platformType",
          "Windows"
        ]
      },
      "inputs": {
        "runCommand": [
          "$v = Get-Volume -DriveLetter C;",
          "$sizeGB = [math]::Round($v.Size/1GB,2);",
          "$freeGB = [math]::Round($v.SizeRemaining/1GB,2);",
          "$usedGB = [math]::Round($sizeGB - $freeGB,2);",
          "$pct = [math]::Round(($freeGB / $sizeGB) * 100,2);",
          "[pscustomobject]@{ Drive='C:'; SizeGB=$sizeGB; UsedGB=$usedGB; FreeGB=$freeGB; FreePercent=$pct } | ConvertTo-Json -Compress"
        ]
      }
    }
  ]
}
