# main.tf

# Define the provider and region
provider "aws" {
  region = "us-east-1" # Specify your desired AWS region
}

# --- Variables for Customization ---

variable "instance_id" {
  description = "The ID of the EC2 instance to monitor."
  type        = string
  default     = "i-0123456789abcdef0" # Replace with your actual EC2 instance ID
}

variable "disk_device" {
  description = "The disk device to monitor (e.g., nvme0n1p1 for root on Nitro-based instances, xvda1 for others)."
  type        = string
  default     = "nvme0n1p1"
}

variable "disk_path" {
  description = "The mount path of the disk to monitor (e.g., /)."
  type        = string
  default     = "/"
}

variable "file_system_type" {
  description = "The file system type of the disk (e.g., xfs, ext4)."
  type        = string
  default     = "xfs"
}


# --- CloudWatch Dashboard Resource ---

resource "aws_cloudwatch_dashboard" "ec2_health_dashboard" {
  dashboard_name = "EC2_Health_Dashboard-${var.instance_id}"

  dashboard_body = jsonencode({
    widgets = [
      {
        type   = "metric"
        x      = 0
        y      = 0
        width  = 8
        height = 6
        properties = {
          metrics = [
            ["AWS/EC2", "CPUUtilization", "InstanceId", var.instance_id]
          ]
          period = 300
          stat   = "Average"
          region = "us-east-1" # Ensure this matches your provider region
          title  = "EC2 CPU Utilization (%)"
          yAxis = {
            left = {
              min = 0
              max = 100
            }
          }
          annotations = {
            horizontal = [
              {
                color = "#ff0000"
                label = "Threshold 80%"
                value = 80
              }
            ]
          }
        }
      },
      {
        type   = "metric"
        x      = 8
        y      = 0
        width  = 8
        height = 6
        properties = {
          metrics = [
            ["CWAgent", "mem_used_percent", "InstanceId", var.instance_id]
          ]
          period = 300
          stat   = "Average"
          region = "us-east-1"
          title  = "Memory Utilization (%)"
          yAxis = {
            left = {
              min = 0
              max = 100
            }
          }
          annotations = {
            horizontal = [
              {
                color = "#ff0000"
                label = "Threshold 80%"
                value = 80
              }
            ]
          }
        }
      },
      {
        type   = "metric"
        x      =
