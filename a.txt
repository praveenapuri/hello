terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }
}

provider "aws" {
  region = "us-east-1" # Or the region where your bucket is located
}

# 1. Reference your existing S3 bucket
#    This tells Terraform to look up the bucket without managing it.
data "aws_s3_bucket" "existing_bucket" {
  # Replace with the exact name of your existing bucket
  bucket = "name-of-your-existing-bucket"
}

# 2. Apply the lifecycle configuration to the referenced bucket
#    This resource will be managed by Terraform.
resource "aws_s3_bucket_lifecycle_configuration" "bucket_lifecycle_rule" {
  # Get the bucket name from the data source above
  bucket = data.aws_s3_bucket.existing_bucket.id

  rule {
    id     = "auto-expire-after-6-months"
    status = "Enabled"

    # Action to take on the objects
    expiration {
      # Number of days after object creation to permanently delete it.
      days = 180
    }

    # You can also filter which objects this rule applies to.
    # For example, to only apply it to files in a 'logs/' folder:
    # filter {
    #   prefix = "logs/"
    # }
  }
}
