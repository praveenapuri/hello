locals {
  # ALB TargetGroup health (all target groups in region)
  # We pull HealthyHostCount and UnHealthyHostCount via SEARCH, no explicit IDs.
  alb_tg_metrics_search = [
    [
      {
        expression = "SEARCH('{AWS/ApplicationELB,TargetGroup} MetricName=\"HealthyHostCount\"', 'Average', 60)"
        id         = "tg_hc"
        label      = "ALB TG - HealthyHostCount"
      }
    ],
    [
      {
        expression = "SEARCH('{AWS/ApplicationELB,TargetGroup} MetricName=\"UnHealthyHostCount\"', 'Average', 60)"
        id         = "tg_uhc"
        label      = "ALB TG - UnHealthyHostCount"
      }
    ]
  ]

  # String for injecting into local.final
  alb_tg_metrics_string = jsonencode(local.alb_tg_metrics_search)
}
    {
      "type": "metric",
      "x": 0,
      "y": 49,
      "width": 24,
      "height": 6,
      "properties": {
        "metrics": ${local.alb_tg_metrics_string},
        "view": "timeSeries",
        "region": "${var.region}",
        "period": 60,
        "stat": "Average",
        "title": "ALB TargetGroup Health - Healthy & UnHealthy Host Counts"
      }
    }
