{
  "schemaVersion": "2.2",
  "description": "Log only when C: free space <25%",
  "parameters": {},
  "mainSteps": [
    {
      "action": "aws:runPowerShellScript",
      "name": "CheckDiskThreshold",
      "inputs": {
        "runCommand": [
          "$v = Get-Volume -DriveLetter C;",
          "$sizeGB = [math]::Round($v.Size/1GB,2);",
          "$freeGB = [math]::Round($v.SizeRemaining/1GB,2);",
          "$pct = if ($sizeGB -gt 0) { [math]::Round(($freeGB / $sizeGB) * 100,2) } else { 0 };",
          "",
          "if ($pct -lt 25) {",
          "  $usedGB = [math]::Round($sizeGB - $freeGB,2);",
          "  $msg = [pscustomobject]@{ Drive='C:'; SizeGB=$sizeGB; UsedGB=$usedGB; FreeGB=$freeGB; FreePercent=$pct };",
          "  $msg | ConvertTo-Json -Compress",
          "}"
        ]
      }
    }
  ]
}
