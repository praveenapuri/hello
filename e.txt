{
  "schemaVersion": "2.2",
  "description": "Return root (C:) volume free space for a Windows instance in GB and color red if < 25%",
  "parameters": {},
  "mainSteps": [
    {
      "action": "aws:runPowerShellScript",
      "name": "GetRootDiskFree",
      "inputs": {
        "runCommand": [
          "$v = Get-Volume -DriveLetter C;",
          "$sizeGB = [math]::Round($v.Size/1GB, 2);",
          "$freeGB = [math]::Round($v.SizeRemaining/1GB, 2);",
          "$usedGB = [math]::Round($sizeGB - $freeGB, 2);",
          "$pct    = if ($sizeGB -gt 0) { [math]::Round(($freeGB / $sizeGB) * 100,2) } else { 0 };",
          "",
          "# ANSI color code for red foreground",
          "$red   = \"`e[31m\"",
          "$reset = \"`e[0m\"",
          "",
          "if ($pct -lt 25) {",
          "  Write-Output (\"$red WARNING: Low Disk Space (C:) - SizeGB=$sizeGB FreeGB=$freeGB UsedGB=$usedGB FreePercent=$pct% $reset\")",
          "} else {",
          "  Write-Output (\"C: SizeGB=$sizeGB FreeGB=$freeGB UsedGB=$usedGB FreePercent=$pct%\")",
          "}"
        ]
      }
    }
  ]
}
